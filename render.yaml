specVersion: 1

# Render Blueprint for deploying the FastAPI backend and a managed Postgres database

databases:
  - name: rag-db
    databaseName: rag_database
    plan: free

services:
  - type: web
    name: rag-backend
    env: python
    rootDir: backend
    plan: free
    autoDeploy: true
    healthCheckPath: /health

    buildCommand: |
      pip install --upgrade pip
      pip install poetry
      poetry config virtualenvs.create false
      poetry install --no-interaction --no-ansi --without dev

    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT

    envVars:
      # DATABASE_URL will automatically reference the managed Postgres instance above
      - key: DATABASE_URL
        fromDatabase:
          name: rag-db
          property: connectionString

      # Optional: provide your Google API key
      - key: GOOGLE_API_KEY
        value: ""

      # Optional: set ALLOWED_ORIGINS to your frontend URL(s), comma-separated
      - key: ALLOWED_ORIGINS
        value: "https://your-frontend-domain.example"

      # Optional: Qdrant configuration (leave blank if not using Qdrant Cloud yet)
      - key: QDRANT_URL
        value: ""
      - key: QDRANT_API_KEY
        value: ""

      # Optional: turn off non-essential features in hosted environment by default
      - key: MCP_SERVER_ENABLED
        value: "false"
      - key: WEB_SEARCH_ENABLED
        value: "false"
